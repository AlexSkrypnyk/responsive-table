/**
 * Responsive Tables jQuery plugin.
 * Author: Alex Skrypnyk (alex.designworks@gmail.com)
 * License: GPL v2 (http://www.gnu.org/licenses/old-licenses/gpl-2.0.html)
 */(function(e,t,n,r){function u(t,n){this.element=t;this.$element=e(t);this.settings=e.extend({},o,n);this._defaults=o;this._name=i;this.init()}var i="responsiveTable",s="0.1",o={responsiveMode:"auto",start:"last",collapseDirection:"rtl",expandTriggerClass:"js-expand-trigger",expandTriggerHtml:"+",collapseTriggerClass:"js-collapse-trigger",collapseTriggerHtml:"-",emptyHeader:!1,expandAlways:[],collapseAlways:[],textDirection:"tb",scrollContainer:!1};e.extend(u.prototype,{init:function(){var n=this;if(n.element.tagName.toLowerCase()!="table")throw"Responsive table plugin should be used on tables only.";n.initTable();n.columnMinWidths=[];e(t).on("resizeEnd",function(e,t){n.settings.responsiveMode=="all"?n.responsiveAll():n.responsiveAuto()}).trigger("resizeEnd");e(n.$element).delegate("."+n.settings.expandTriggerClass,"click",function(){n.expandColumn(n.getColumnFromTrigger(e(this)),!0)});e(n.$element).delegate("."+n.settings.collapseTriggerClass,"click",function(){n.collapseColumn(n.getColumnFromTrigger(e(this)))})},responsiveAll:function(){var e=this.$element.outerWidth()>this.$container.width();for(var t in this.columns)e?this.collapseColumn(parseInt(t,10)):this.expandColumn(parseInt(t,10))},responsiveAuto:function(){this.$element.outerWidth()>this.$container.width()&&this.gatherMinWidths();var t=this.initCurrent();while(this.$element.outerWidth()>this.$container.width()&&t!==!1){this.collapseColumn(t);t=this.getNext(t);e(this.$element).trigger("responsiveTable.tableCollapse")}if(this.columnMinWidths.length>0){this.gatherCollapsedWidths();t=this.initCurrent(!0);while(t!==!1){if(this.columnCollapsedWidths[t]){var n=this.getPredictedWidth(t);n<this.$container.width()&&this.expandColumn(t,!1)}t=this.getNext(t,!0)}}},initTable:function(){var t=this;t.$element.addClass("js-responsive-table-processed");t.settings.scrollContainer&&t.initScrollContainer();t.$container=t.$element.parent();t.$header=this.$element.find("th");t.$rows=this.$element.find("tr").filter(function(){return e(this).parent().get(0).tagName.toLowerCase()!="thead"&&e(this).children(":first").get(0).tagName.toLowerCase()!="th"});t.columns=t.getColumns(t.$element);t.maxColumns=Object.keys(t.columns).length;t.settings.expandAlways=t.parseRange(t.settings.expandAlways);t.settings.collapseAlways=t.parseRange(t.settings.collapseAlways);t.initCollapseAlways()},initCollapseAlways:function(){for(var e=0;e<this.settings.collapseAlways.length;e++)this.collapseColumn(this.settings.collapseAlways[e])},parseRange:function(t,n,r){var i=this,s=[];n=n||0;r=r||i.maxColumns-1;var o=n;for(var u=0;u<t.length;u++){if(t[u]=="first")s.push(n);else if(t[u]=="last")s.push(r);else if(e.isNumeric(t[u]))s.push(t[u]>0&&t[u]<i.maxColumns?t[u]:n);else if(t[u]=="*"){var a=[],f=u+1<t.length?i.parseRange([t[u+1]],n,r):[r];f=f.pop();for(var l=o;l<=f;l++)a.push(l);s=e.merge(s,a)}o=s.length>0?s[s.length-1]:n}return e.grep(s,function(t,n){return n==e.inArray(t,s)})},gatherMinWidths:function(){var t=this;t.columnMinWidths=[];t.$header.each(function(){t.columnMinWidths.push(t.getCellWidth(e(this)))});return t.columnMinWidths},gatherCollapsedWidths:function(){var t=this;t.columnCollapsedWidths=[];t.$header.each(function(){e(this).hasClass("js-head-collapsed")?t.columnCollapsedWidths.push(t.getCellWidth(e(this))):t.columnCollapsedWidths.push(!1)});return t.columnCollapsedWidths},getPredictedWidth:function(e){var t=0;for(var n in this.columnCollapsedWidths)n==e?t+=this.columnMinWidths[n]:this.columnCollapsedWidths[n]!==!1?t+=this.columnCollapsedWidths[n]:t+=this.columnMinWidths[n];return t},getCellWidth:function(e){var t=0;t+=parseInt(e.css("border-left-width"),10);t+=parseInt(e.css("border-right-width"),10);return e.outerWidth()+t},getNext:function(e,t){t=t||!1;var n=this.settings.collapseDirection=="ltr"?1:-1;n*=t?-1:1;e+=n;return e>=this.maxColumns||e<0?!1:e},initCurrent:function(t){t=t||!1;return this.settings.start=="first"?t?this.maxColumns-1:0:e.isNumeric(this.settings.start)?this.settings.start>0&&this.settings.start<this.maxColumns?t?this.maxColumns-this.settings.start:this.settings.start:t?0:this.maxColumns-1:t?0:this.maxColumns-1},getColumns:function(){var t={},n=this.getSpanMatrix(),i,s,o,u,a;for(i=0,idxHeaderSpan=0;i<this.$header.length;i++){o=this.$header.eq(i).attr("colspan")!==r?parseInt(this.$header.eq(i).attr("colspan"),10):1;this.$rows.each(function(r){t[i]=t[i]||e();for(s=idxHeaderSpan;s<idxHeaderSpan+o;){u=0;if(s>0)for(a=s-1;a>=0;a--)u+=n[r][a]>0;n[r][s]>0&&(t[i]=t[i].add(e(this).find("td").eq(u)));s++}});idxHeaderSpan+=o}return t},getSpanMatrix:function(){var t=[];this.$rows.each(function(n){t[n]=t[n]||[];e(this).find("td").each(function(){tdColspan=e(this).attr("colspan")!==r?parseInt(e(this).attr("colspan"),10):1;t[n].push(tdColspan);if(tdColspan>1)for(var i=0;i<tdColspan-1;i++)t[n].push(0)})});return t},triggerHtml:function(e){return e+"TriggerHtml"in this.settings&&this.settings[e+"TriggerHtml"]?'<span class="'+this.settings[e+"TriggerClass"]+'">'+this.settings[e+"TriggerHtml"]+"</span>":""},collapseColumn:function(t){if(e.inArray(t,this.settings.expandAlways)!=-1)return;this.settings.emptyHeader?this.collapseColumnNoHeader(t):this.collapseColumnHeader(t)},collapseColumnHeader:function(e){var t=this.$header.eq(e);if(!t.hasClass("js-head-collapsed")){t.addClass("js-head-collapsed").addClass(this.getTextDirectionClass());t.attr("rowspan",this.$rows.length+1);t.find(".js-vertical-text").length==0&&t.wrapInner('<div class="js-vertical-text"><div class="js-vertical-text--inner"></div></div>');t.find("."+this.settings.collapseTriggerClass).remove();t.find("."+this.settings.expandTriggerClass).length==0&&t.prepend(this.triggerHtml("expand"));this.columns[e].addClass("js-cell-collapsed")}},collapseColumnNoHeader:function(e){var t=this.$header.eq(e);if(!t.hasClass("js-head-collapsed")){t.before(t.clone().html("").addClass("js-cell-replacement").addClass(this.getTextDirectionClass()));t.addClass("js-head-collapsed").addClass(this.getTextDirectionClass());t.attr("rowspan",this.$rows.length+1);t.find(".js-vertical-text").length==0&&t.wrapInner('<div class="js-vertical-text"><div class="js-vertical-text--inner"></div></div>');t.find("."+this.settings.collapseTriggerClass).remove();t.find("."+this.settings.expandTriggerClass).length==0&&t.prepend(this.triggerHtml("expand"));var n=t.clone(!0,!0);t.hide();n.addClass("js-cell-replacement").addClass(this.getTextDirectionClass());n.attr("rowspan",this.$rows.length);this.columns[e].addClass("js-cell-collapsed");this.columns[e].eq(0).before(n)}},expandColumn:function(t,n){if(e.inArray(t,this.settings.collapseAlways)!=-1)return;this.settings.emptyHeader?this.expandColumnNoHeader(t,n):this.expandColumnHeader(t,n)},expandColumnHeader:function(e,t){var n=this.$header.eq(e);if(n.hasClass("js-head-collapsed")){n.removeClass("js-head-collapsed");n.removeAttr("rowspan");n.find("."+this.settings.expandTriggerClass).remove();n.html(n.find(".js-vertical-text--inner").html());n.find("."+this.settings.collapseTriggerClass).length==0&&t&&n.prepend(this.triggerHtml("collapse"));this.columns[e].removeClass("js-cell-collapsed")}},expandColumnNoHeader:function(e,t){var n=this.$header.eq(e);if(n.hasClass("js-head-collapsed")){n.removeClass("js-head-collapsed");n.removeAttr("rowspan");n.find("."+this.settings.expandTriggerClass).remove();n.html(n.find(".js-vertical-text--inner").html());n.find("."+this.settings.collapseTriggerClass).length==0&&t&&n.prepend(this.triggerHtml("collapse"));n.prev(".js-cell-replacement").remove();this.columns[e].eq(0).prev(".js-cell-replacement").remove();this.columns[e].removeClass("js-cell-collapsed");n.show()}},getColumnFromTrigger:function(e){var t=e.parents("th:first"),n=t.parent(),r=0;if(n.get(0)==this.$rows.get(0))return this.findClosestColumn(t);for(var i=0;i<n.children().length;i++){if(n.children().get(i)==t.get(0))break;n.children().eq(i).hasClass("js-cell-replacement")||r++}return r},findClosestColumn:function(e){for(var t in this.columns)if(this.columns[t].eq(0).prev().get(0)==e.get(0))return t;return!1},getTextDirectionClass:function(){return"align-"+this.settings.textDirection},initScrollContainer:function(){var t=e("<div></div>").css({overflow:"hidden",overflowX:"scroll"});this.$element.wrap(t)}});e.fn[i]=function(t){this.each(function(){e.data(this,"plugin_"+i)||e.data(this,"plugin_"+i,new u(this,t))});return this}})(jQuery,window,document);